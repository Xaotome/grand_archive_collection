<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Effect Badges</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        body {
            padding: 20px;
            font-family: Inter, sans-serif;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #ccc;
            background: #f9f9f9;
        }
        .test-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        .test-output {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border: 1px solid #ddd;
            min-height: 40px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #000;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #333;
        }
    </style>
</head>
<body>
    <h1>Test des badges d'effets de cartes</h1>
    
    <div class="test-section">
        <h2>Test manuel</h2>
        <input type="text" id="manual-input" class="test-input" 
               placeholder="Entrez du texte avec [Class Bonus] ou [On Enter]" 
               value="Draw a card. [Class Bonus] - Draw an additional card. [On Enter]: Gain 1 memory.">
        <button onclick="testManual()">Tester</button>
        <div id="manual-output" class="test-output"></div>
    </div>
    
    <div class="test-section">
        <h2>Tests automatiques</h2>
        <button onclick="runAllTests()">Lancer tous les tests</button>
        <div id="auto-tests-output"></div>
    </div>

    <script>
        // Copie de la fonction parseEffectBadges pour test
        function parseEffectBadges(effectText) {
            console.log('parseEffectBadges input:', effectText);
            
            if (!effectText || typeof effectText !== 'string') {
                console.log('No valid effect text:', effectText);
                return effectText || '';
            }

            // Échapper le HTML d'abord si ce n'est pas déjà du HTML
            let processedText = effectText;
            if (!effectText.includes('<') || !effectText.includes('>')) {
                // Ce n'est pas du HTML, on échappe les caractères dangereux
                processedText = escapeHtml(effectText);
                console.log('HTML escaped:', processedText);
            }

            // Regex pour capturer tout ce qui est entre crochets [...]
            const bracketRegex = /\[([^\]]+)\]/g;
            
            // Vérifier s'il y a des correspondances
            const matches = processedText.match(bracketRegex);
            console.log('Found bracket matches:', matches);
            
            // Remplacer tous les éléments entre crochets par des badges
            processedText = processedText.replace(bracketRegex, (match, content) => {
                const badge = `<span class="effect-badge">${content.trim()}</span>`;
                console.log('Replacing:', match, 'with:', badge);
                return badge;
            });

            console.log('Final processed text:', processedText);
            return processedText;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function testManual() {
            const input = document.getElementById('manual-input').value;
            const output = document.getElementById('manual-output');
            
            console.log('=== TEST MANUAL ===');
            const result = parseEffectBadges(input);
            output.innerHTML = result;
        }

        function runAllTests() {
            const output = document.getElementById('auto-tests-output');
            
            const tests = [
                {
                    name: 'Test simple avec Class Bonus',
                    input: 'Draw a card. [Class Bonus] - Draw an additional card.',
                    expected: 'Draw a card. <span class="effect-badge">Class Bonus</span> - Draw an additional card.'
                },
                {
                    name: 'Test avec On Enter',
                    input: '[On Enter]: You may pay (2). If you do, draw a card.',
                    expected: '<span class="effect-badge">On Enter</span>: You may pay (2). If you do, draw a card.'
                },
                {
                    name: 'Test avec multiples crochets',
                    input: '[Level 1]: Deal 1 damage. [Class Bonus]: Deal 2 damage instead.',
                    expected: '<span class="effect-badge">Level 1</span>: Deal 1 damage. <span class="effect-badge">Class Bonus</span>: Deal 2 damage instead.'
                },
                {
                    name: 'Test sans crochets',
                    input: 'Simple effect text without brackets.',
                    expected: 'Simple effect text without brackets.'
                },
                {
                    name: 'Test texte vide',
                    input: '',
                    expected: ''
                },
                {
                    name: 'Test HTML existant',
                    input: '<p>[Class Bonus]: Draw a card.</p>',
                    expected: '<p><span class="effect-badge">Class Bonus</span>: Draw a card.</p>'
                }
            ];

            let results = '<h3>Résultats des tests:</h3>';
            
            tests.forEach((test, index) => {
                console.log(`=== TEST ${index + 1}: ${test.name} ===`);
                const result = parseEffectBadges(test.input);
                const passed = result === test.expected;
                
                results += `
                    <div style="margin: 10px 0; padding: 10px; background: ${passed ? '#d4edda' : '#f8d7da'}; border-radius: 4px;">
                        <h4>${test.name} - ${passed ? '✅ RÉUSSI' : '❌ ÉCHOUÉ'}</h4>
                        <p><strong>Entrée:</strong> ${escapeHtml(test.input)}</p>
                        <p><strong>Attendu:</strong> ${escapeHtml(test.expected)}</p>
                        <p><strong>Obtenu:</strong> ${escapeHtml(result)}</p>
                        <p><strong>Rendu:</strong> <span style="background: white; padding: 5px;">${result}</span></p>
                    </div>
                `;
            });
            
            output.innerHTML = results;
        }

        // Auto-run tests on load
        window.onload = function() {
            runAllTests();
        };
    </script>
</body>
</html>